--[[
    AUTO HOP V7: PARALLEL EXECUTION FIX
    Masalah sebelumnya: Script Cheat memblokir Script Hop.
    Solusi: Menggunakan task.spawn agar Script Hop tetap berjalan memantau Boss.
]]

-- === KONFIGURASI ===
local monsterName = "Kokushibo" 
local folderName = "CharactersAndNPCs"
local delayBeforeCheck = 4
local delayAfterKill = 7
-- ===================

local Players = game:GetService("Players")
local Http = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

print("--- SYSTEM START: V7 PARALLEL MODE ---")

if not game:IsLoaded() then
    game.Loaded:Wait()
end
task.wait(delayBeforeCheck)

-- 1. FUNGSI HOP SERVER
local function ServerHop()
    print("Memicu Server Hop...")
    StarterGui:SetCore("SendNotification", {
        Title = "Auto Hop",
        Text = "Pindah Server...",
        Duration = 3
    })
    
    local PlaceID = game.PlaceId
    local success, result = pcall(function()
        return Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. PlaceID .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)

    if not success or not result or not result.data then
        TPS:Teleport(PlaceID, Players.LocalPlayer)
        return
    end

    local Servers = {}
    for _, server in pairs(result.data) do
        if server.playing < server.maxPlayers and server.id ~= game.JobId then
            table.insert(Servers, server.id)
        end
    end

    if #Servers > 0 then
        local randomServerId = Servers[math.random(1, #Servers)]
        TPS:TeleportToPlaceInstance(PlaceID, randomServerId, Players.LocalPlayer)
    else
        TPS:Teleport(PlaceID, Players.LocalPlayer)
    end
end

-- 2. LOGIKA UTAMA
local folder = Workspace:FindFirstChild(folderName)
local bossFound = false
local targetHumanoid = nil

if folder then
    local monster = folder:FindFirstChild(monsterName)
    if monster then
        local humanoid = monster:FindFirstChild("Humanoid")
        if humanoid and humanoid.Health > 0 then
            bossFound = true
            targetHumanoid = humanoid
        end
    end
end

-- 3. EKSEKUSI PARALEL (PERBAIKAN UTAMA DI SINI)
if bossFound then
    print("âœ… BOSS DITEMUKAN! Menjalankan Cheat & Monitor secara bersamaan.")
    StarterGui:SetCore("SendNotification", {
        Title = "TARGET LOCKED",
        Text = "Cheat jalan, Monitor jalan.",
        Duration = 5
    })

    -- >>> TASK.SPAWN: JALANKAN CHEAT DI JALUR TERPISAH <<<
    task.spawn(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Omgshit/Scripts/main/MainLoader.lua"))()
    end)

    -- >>> SCRIPT HOP TETAP LANJUT KE BAWAH (MONITORING) <<<
    print("â³ Monitor aktif: Menunggu boss mati...")
    
    repeat
        task.wait(1)
        -- Cek apakah humanoid masih ada & darah > 0
    until not targetHumanoid or not targetHumanoid.Parent or targetHumanoid.Health <= 0

    print("ðŸ’€ BOSS MATI! Menghitung mundur untuk Hop...")
    StarterGui:SetCore("SendNotification", {
        Title = "BOSS DEFEATED",
        Text = "Hop Server dalam " .. delayAfterKill .. " detik...",
        Duration = delayAfterKill
    })
    
    task.wait(delayAfterKill)
    ServerHop()

else
    print("âŒ Boss tidak ada/mati. Langsung Hop.")
    ServerHop()
end
