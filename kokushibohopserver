--[[
    AUTO HOP V5: FINAL HEALTH CHECK
    Target: Workspace.CharactersAndNPCs.Kokushibo
    Logika: Hanya berhenti jika Monster HIDUP (Health > 0)
]]

-- === KONFIGURASI ===
local monsterName = "Kokushibo" 
local folderName = "CharactersAndNPCs" -- Folder Path (Sesuai ralatmu)
local delayBeforeCheck = 4 -- Waktu tunggu loading (detik) agar tidak salah deteksi
-- ===================

local Players = game:GetService("Players")
local Http = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

print("--- SCRIPT DIMULAI: MENCARI BOSS HIDUP ---")

-- 1. Tunggu Game Loading
if not game:IsLoaded() then
    game.Loaded:Wait()
end
task.wait(delayBeforeCheck)

-- 2. Fungsi Server Hop (Versi V2 Stabil)
local function ServerHop()
    print("Kondisi tidak terpenuhi (Boss Mati/Hilang). Hop Server...")
    StarterGui:SetCore("SendNotification", {
        Title = "Auto Hop",
        Text = "Boss MATI atau KOSONG. Mencari server baru...",
        Duration = 5
    })
    
    local PlaceID = game.PlaceId
    local success, result = pcall(function()
        -- sortOrder=Asc mencari server yang lebih sepi (fresh)
        return Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. PlaceID .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)

    if not success or not result or not result.data then
        warn("Gagal API atau Rate Limit. Rejoin server lama...")
        TPS:Teleport(PlaceID, Players.LocalPlayer)
        return
    end

    local Servers = {}
    for _, server in pairs(result.data) do
        if server.playing < server.maxPlayers and server.id ~= game.JobId then
            table.insert(Servers, server.id)
        end
    end

    if #Servers > 0 then
        local randomServerId = Servers[math.random(1, #Servers)]
        TPS:TeleportToPlaceInstance(PlaceID, randomServerId, Players.LocalPlayer)
    else
        warn("Tidak ada server lain yang valid.")
        TPS:Teleport(PlaceID, Players.LocalPlayer)
    end
end

-- 3. LOGIKA UTAMA (CHECK HEALTH)
local folder = Workspace:FindFirstChild(folderName)

if folder then
    local monster = folder:FindFirstChild(monsterName)
    
    if monster then
        local humanoid = monster:FindFirstChild("Humanoid")
        
        -- INI LOGIKA KUNCINYA:
        -- Kita pastikan Humanoid ada DAN Health-nya di atas 0
        if humanoid and humanoid.Health > 0 then
            -- KONDISI: HIDUP -> STOP HOP
            print("✅ BOSS HIDUP DITEMUKAN! (HP: " .. math.floor(humanoid.Health) .. ")")
            StarterGui:SetCore("SendNotification", {
                Title = "✅ BOSS HIDUP!",
                Text = "Script STOP. Silakan hajar!",
                Duration = 10
            })
            -- Script berhenti di sini, tidak melakukan apa-apa lagi.
            
        else
            -- KONDISI: ADA TAPI MATI (HP 0) -> HOP
            print("⚠️ Boss ditemukan tapi sudah MATI (Health 0 / Di bawah tanah).")
            ServerHop()
        end
    else
        -- KONDISI: TIDAK ADA MODEL -> HOP
        print("❌ Model Boss tidak ada di folder.")
        ServerHop()
    end
else
    -- KONDISI: FOLDER GAK ADA -> HOP
    print("❌ Folder " .. folderName .. " tidak ditemukan.")
    ServerHop()
end
