--[[
    AUTO HOP & AUTO EXECUTE CHAIN
    Target: Workspace.CharactersAndNPCs.Kokushibo
    Logic: Cek Boss -> Jika Hidup, Execute Script Cheat. Jika Mati, Hop Server.
]]

-- === KONFIGURASI ===
local monsterName = "Kokushibo" 
local folderName = "CharactersAndNPCs"
local delayBeforeCheck = 4
-- ===================

local Players = game:GetService("Players")
local Http = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

print("--- SYSTEM STARTED: HOP OR FARM ---")

if not game:IsLoaded() then
    game.Loaded:Wait()
end
task.wait(delayBeforeCheck)

-- 1. FUNGSI HOP SERVER
local function ServerHop()
    StarterGui:SetCore("SendNotification", {
        Title = "Auto Hop",
        Text = "Boss Mati/Tidak Ada. Pindah server...",
        Duration = 5
    })
    
    local PlaceID = game.PlaceId
    local success, result = pcall(function()
        return Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. PlaceID .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)

    if not success or not result or not result.data then
        TPS:Teleport(PlaceID, Players.LocalPlayer)
        return
    end

    local Servers = {}
    for _, server in pairs(result.data) do
        if server.playing < server.maxPlayers and server.id ~= game.JobId then
            table.insert(Servers, server.id)
        end
    end

    if #Servers > 0 then
        local randomServerId = Servers[math.random(1, #Servers)]
        TPS:TeleportToPlaceInstance(PlaceID, randomServerId, Players.LocalPlayer)
    else
        TPS:Teleport(PlaceID, Players.LocalPlayer)
    end
end

-- 2. LOGIKA PENGECEKAN & EKSEKUSI BERANTAI
local folder = Workspace:FindFirstChild(folderName)
local shouldHop = true -- Defaultnya kita anggap harus hop dulu

if folder then
    local monster = folder:FindFirstChild(monsterName)
    
    if monster then
        local humanoid = monster:FindFirstChild("Humanoid")
        
        -- CEK APAKAH BOSS HIDUP?
        if humanoid and humanoid.Health > 0 then
            shouldHop = false -- JANGAN HOP, Boss ada!
            
            print("✅ BOSS DITEMUKAN! Mengaktifkan Script Farm...")
            StarterGui:SetCore("SendNotification", {
                Title = "TARGET LOCKED!",
                Text = "Menjalankan Auto Farm...",
                Duration = 5
            })
            
            -- >>> INI BAGIAN PENTINGNYA <<<
            -- Script kedua hanya dijalankan di sini:
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Omgshit/Scripts/main/MainLoader.lua"))()
            
        else
            print("⚠️ Boss mati (HP 0).")
        end
    else
        print("❌ Model Boss tidak ada.")
    end
else
    print("❌ Folder Boss tidak ada.")
end

-- 3. EKSEKUSI HOP JIKA DIPERLUKAN
if shouldHop then
    ServerHop()
end
