--[[
    AUTO HOP V6: KILL & HOP LOOP
    Target: Workspace.CharactersAndNPCs.Kokushibo
    Logic: 
    1. Cek Boss.
    2. Jika HIDUP -> Execute Cheat -> Tunggu Mati -> Hop.
    3. Jika MATI -> Langsung Hop.
]]

-- === KONFIGURASI ===
local monsterName = "Kokushibo" 
local folderName = "CharactersAndNPCs"
local delayBeforeCheck = 4      -- Waktu loading awal
local delayAfterKill = 5        -- Waktu tunggu setelah boss mati (untuk ambil loot/drop) sebelum pindah
-- ===================

local Players = game:GetService("Players")
local Http = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

print("--- SYSTEM START: KILL & HOP LOOP ---")

if not game:IsLoaded() then
    game.Loaded:Wait()
end
task.wait(delayBeforeCheck)

-- 1. FUNGSI HOP SERVER
local function ServerHop()
    print("Mencari server baru...")
    StarterGui:SetCore("SendNotification", {
        Title = "Auto Hop",
        Text = "Pindah Server...",
        Duration = 3
    })
    
    local PlaceID = game.PlaceId
    local success, result = pcall(function()
        return Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. PlaceID .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)

    if not success or not result or not result.data then
        TPS:Teleport(PlaceID, Players.LocalPlayer)
        return
    end

    local Servers = {}
    for _, server in pairs(result.data) do
        if server.playing < server.maxPlayers and server.id ~= game.JobId then
            table.insert(Servers, server.id)
        end
    end

    if #Servers > 0 then
        local randomServerId = Servers[math.random(1, #Servers)]
        TPS:TeleportToPlaceInstance(PlaceID, randomServerId, Players.LocalPlayer)
    else
        TPS:Teleport(PlaceID, Players.LocalPlayer)
    end
end

-- 2. LOGIKA UTAMA
local folder = Workspace:FindFirstChild(folderName)
local bossFound = false
local targetHumanoid = nil

-- Cek Keberadaan Boss
if folder then
    local monster = folder:FindFirstChild(monsterName)
    if monster then
        local humanoid = monster:FindFirstChild("Humanoid")
        if humanoid and humanoid.Health > 0 then
            bossFound = true
            targetHumanoid = humanoid
        end
    end
end

-- 3. EKSEKUSI SKENARIO
if bossFound then
    -- SKENARIO A: BOSS ADA
    print("‚úÖ BOSS DITEMUKAN! Execute Script Cheat...")
    StarterGui:SetCore("SendNotification", {
        Title = "TARGET DITEMUKAN",
        Text = "Menjalankan Auto Farm & Menunggu Kill...",
        Duration = 5
    })

    -- A. Jalankan Script Cheat
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Omgshit/Scripts/main/MainLoader.lua"))()

    -- B. LOOP MONITORING (Tunggu sampai boss mati)
    print("‚è≥ Menunggu boss mati...")
    repeat
        task.wait(1) -- Cek setiap 1 detik
    until targetHumanoid.Health <= 0 or not targetHumanoid.Parent

    -- C. Boss Mati -> Hop
    print("üíÄ BOSS MATI! Menunggu loot...")
    StarterGui:SetCore("SendNotification", {
        Title = "BOSS DEFEATED",
        Text = "Pindah server dalam " .. delayAfterKill .. " detik...",
        Duration = delayAfterKill
    })
    
    task.wait(delayAfterKill) -- Tunggu sebentar barangkali ada drop item
    ServerHop()

else
    -- SKENARIO B: BOSS TIDAK ADA / MATI
    print("‚ùå Boss tidak ada/mati. Langsung Hop.")
    ServerHop()
end
